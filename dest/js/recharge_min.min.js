"use strict";function hideMenu(){WeixinJSBridge.call("hideOptionMenu"),WeixinJSBridge.call("hideToolbar")}function get_recharge_result(){$.ajax({url:"/prepaid/v1/api/c/recharge/result",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h"),biz_sn:get_hash("biz_sn"),syssn:get_hash("syssn")},start:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=(a.pay_amt/100).toFixed(2),t=(a.txamt/100).toFixed(2),r=a.uri;$(".js_paynum").text(s),$(".js_chargenum").text(t),$(".js_result_buy").attr("href",r),get_rechargedetail()}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},end:function(){$("#loading").hide(),$(".zheceng").hide()}})}function get_rule_detail(){$.ajax({url:"/prepaid/v1/api/c/rulexplain",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},beforeSend:function(){$("#loading").show(),$(".zheceng1").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng1").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{for(var a=e.data,s=a.length,t=0;t<s;t++){var r="<li><span>"+a[t]+"</span></li>";$(".js_note_ul_detail").append(r)}$(".zheceng1").hide()}},error:function(e){$("#alert_alert").show(),$(".zheceng1").show(),$("#alert_alert .alert_con_br").html("网络超时!")},complete:function(){$("#loading").hide()}})}function get_message(){$(".js_dl_message input").val(""),$.ajax({url:"/prepaid/v1/api/c/bind",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},beforeSend:function(){$("#loading").show(),$(".zheceng2").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng2").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=a.binded,t=a.name,r=a.mobile,n=a.birthday;$(".js_hidden_first").val(s),$(".js_message_name").val(t),$(".js_message_tel").val(r),$(".js_message_birth").val(n),"1"==s?($(".js_dl_message input.js_input").attr("readonly","readonly").addClass("grey"),n.length>0?$(".js_message_birth").attr("disabled","disabled").addClass("grey"):$(".js_message_birth").removeAttr("disabled").removeClass("grey")):($(".js_dl_message input.js_input").removeAttr("readonly").removeClass("grey"),$(".js_message_birth").removeAttr("disabled").removeClass("grey")),$(".zheceng2").hide()}},error:function(e){$("#alert_alert").show(),$(".zheceng2").show(),$("#alert_alert .alert_con_br").html("网络超时!")},complete:function(){$("#loading").hide()}})}function get_message_bf(){$(".js_dl_message input").val(""),$.ajax({url:"/prepaid/v1/api/c/bind",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},beforeSend:function(){$("#loading").show(),$(".zheceng2").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng2").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=a.binded,t=a.name,r=a.mobile,n=a.birthday;$(".js_hidden_first").val(s),"1"==s?($(".js_dl_message input.js_input").attr("readonly","readonly"),$(".js_message_name").val(t),$(".js_message_tel").val(r),n.length>0?$(".js_message_birth").val(n).attr("disabled","true"):$(".js_message_birth").removeAttr("disabled")):($(".js_dl_message input.js_input").removeAttr("readonly"),$(".js_message_birth").removeAttr("disabled")),$(".zheceng2").hide()}},error:function(e){$("#alert_alert").show(),$(".zheceng2").show(),$("#alert_alert .alert_con_br").html("网络超时!")},complete:function(){$("#loading").hide()}})}function get_rechargesub(e,a,s){$.ajax({url:"/prepaid/v1/api/c/recharge",type:"POST",dataType:"json",data:{c:get_hash("c"),h:get_hash("h"),o:get_hash("o"),grid_index:$(".js_rechage_ul li.li_choose").attr("data-index"),name:e,mobile:a,birthday:s},beforeSend:function(){$(".js_alert_message").hide(),$(".js_load_message").show().css("display","inline-block")},success:function(e){"0000"!=e.respcd?($(".js_alert_message").show().css("display","inline-block"),$(".js_load_message").hide(),$("#alert_message").hide(),$("#passerror_alert").show(),$(".zheceng").show(),e.respmsg?$("#passerror_alert .alert_con_br").html(e.respmsg):$("#passerror_alert .alert_con_br").html(e.resperr)):window.location.href=e.data.url},error:function(e){$(".js_alert_message").show().css("display","inline-block"),$(".js_load_message").hide(),$("#alert_message").hide(),$("#passerror_alert").show(),$(".zheceng").show(),$("#passerror_alert .alert_con_br").html("网络超时!")},complete:function(){}})}function get_rechargeli(){$.ajax({url:"/prepaid/v1/api/c/recharge/rules",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},beforeSend:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data.expired;if("1"==a)return $(".js_li_none").show(),$(".js_li_show").hide(),$(".zheceng").hide(),!1;$(".js_li_none").hide(),$(".js_li_show").show();var s=e.data.rules,t=[];$(s).each(function(e,a){var r=(s[e].present_amt/100).toFixed(0),n=(s[e].pay_amt/100).toFixed(0);r>=1&&n>=1&&t.push(a)});var r=t.length;if("0"==r)return $(".js_content_sub_disa").show(),$(".js_content_sub").hide(),$(".zheceng").hide(),!1;$(".js_content_sub_disa").hide(),$(".js_content_sub").show(),$(t).each(function(e,a){var s,n=(t[e].present_amt/100).toFixed(0),l=(t[e].pay_amt/100).toFixed(0),o=t[e].grid_index;s="1"==r?'<li class="li_one" onclick="click_chulist(this)" data-index="'+o+'"><p class="font_17">储值<span class="js_rechar_num">'+l+'</span>元</p><p>送<span class="js_rechar_sendnum">'+n+'</span>元</p><span class="choose"><i class="choose_i"></i></span></li>':"2"==r?'<li class="li_two" onclick="click_chulist(this)" data-index="'+o+'"><p class="font_17">储值<span class="js_rechar_num">'+l+'</span>元</p><p>送<span class="js_rechar_sendnum">'+n+'</span>元</p><span class="choose"><i class="choose_i"></i></span></li>':'<li onclick="click_chulist(this)" data-index="'+o+'"><p class="font_17">储值<span class="js_rechar_num">'+l+'</span>元</p><p>送<span class="js_rechar_sendnum">'+n+'</span>元</p><span class="choose"><i class="choose_i"></i></span></li>',$(".js_rechage_ul").append(s)}),$(".js_rechage_ul li").eq(0).addClass("li_choose"),$(".zheceng").hide()}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},complete:function(){$("#loading").hide()}})}function get_hash(e){var a;if(location.href.split("?").length<2)return!1;for(var s=location.href.split("?")[1].split("&"),t=s.length,r=0;r<t;r++){var n=s[r].split("=");if(n[0]==e)return a=n[1]}}function china_test(e,a,s){var t=$(e).val(),r=new RegExp("^[一-龥]{"+a+","+s+"}$");r.test(t)?$(e).removeClass("border_red"):$(e).addClass("border_red")}function tel_test(e){var a=$(e).val(),s=/^1[0-9]{10}$/;s.test(a)?$(e).removeClass("border_red"):$(e).addClass("border_red")}function birth_test(e,a,s){var t=$(e).val(),r=t.length;r<=a||r>s?$(e).addClass("border_red"):$(e).removeClass("border_red")}function get_rechargedetail(){var e=get_hash("h");$.ajax({url:"/prepaid/v1/api/c/merchants/"+e,type:"GET",dataType:"json",data:{c:get_hash("c")},start:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=a.merchant_name,t=(a.balance/100).toFixed(2);$(".js_paycompa").text(s),$(".js_leftnum").text(t)}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},end:function(){$("#loading").hide(),$(".zheceng").hide()}})}function get_rechargediff(){$.ajax({url:"/prepaid/v1/api/c/recharge/balance",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},start:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=(a.balance/100).toFixed(2);$(".js_paynum").text(s)}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},end:function(){$("#loading").hide(),$(".zheceng").hide()}})}function get_protocol_detail(){$.ajax({url:"/prepaid/v1/api/c/recharge/balance",type:"GET",dataType:"json",data:{c:get_hash("c"),h:get_hash("h")},start:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){if("0000"!=e.respcd)$("#alert_alert").show(),$(".zheceng").show(),e.respmsg?$("#alert_alert .alert_con_br").html(e.respmsg):$("#alert_alert .alert_con_br").html(e.resperr);else{var a=e.data,s=a.detail;$("#js_protocol_detail").html(s)}},error:function(e){$("#alert_alert").show(),$(".zheceng").show(),$("#alert_alert .alert_con_br").html("网络超时!")},end:function(){$("#loading").hide(),$(".zheceng").hide()}})}function recharge_num(e){var a=$(e).find(".js_rechar_num").text(),s=(a-0).toFixed("2");$(".js_paynum").text(s)}function pay_now(){var e={};e.amt=1,e.openid=$("#openid").val(),e.syssn=$("#syssn").val(),e.userid=$("#userid").val(),$.ajax({url:location.pathname,type:"post",dataType:"json",data:e,start:function(){$("#loading").show(),$(".zheceng").show()},success:function(e){$("#loading").hide(),$(".zheceng").hide(),"0000"!=e.respcd?($(".alert_con").show(),e.respmsg?$(".alert_con .alert_con_br").html(e.respmsg):$(".alert_con .alert_con_br").html(e.resperr),$(".zheceng").show(),WeixinJSBridge.invoke("closeWindow",{},function(e){})):pay(e)},error:function(e){$("#loading").hide(),$(".alert_con").show(),$(".zheceng").show(),e.respmsg?$(".alert_con .alert_con_br").html(e.respmsg):$(".alert_con .alert_con_br").html(e.resperr),WeixinJSBridge.invoke("closeWindow",{},function(e){})},end:function(){$("#loading").hide(),$(".zheceng").hide()}})}function pay(e){var a=e.data.pay_params;WeixinJSBridge.invoke("getBrandWCPayRequest",{package:a.package,timeStamp:a.timeStamp,signType:a.signType,paySign:a.paySign,appId:a.appId,nonceStr:a.nonceStr},function(a){"get_brand_wcpay_request:ok"==a.err_msg?($.ajax({url:"/trade/wechat/v1/set_result",data:{syssn:e.data.syssn,userid:$("#userid").val()},type:"get"}),WeixinJSBridge.invoke("closeWindow",{},function(e){})):"get_brand_wcpay_request:cancel"==a.err_msg||WeixinJSBridge.invoke("closeWindow",{},function(e){})})}function alert_top(e){var a=$(e).height(),s=a/2-20;$(e).css("marginTop",-s+"px")}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",hideMenu,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",hideMenu),document.attachEvent("onWeixinJSBridgeReady",hideMenu)):hideMenu();var return_expired=$("#hidden").val();"1"==return_expired?($(".js_li_none").show(),$(".js_li_show").hide()):($(".js_li_none").hide(),$(".js_li_show").show()),$(".js_recharge_index").get(0)&&~function(){$(document).ready(function(){}),$(document).on("click",".js_rechage_ul li",function(){$(this).addClass("li_choose").siblings("li").removeClass("li_choose")}),$(".js_scan_protocol").on("click",function(){$("#alert_protocol").show(),$(".zheceng").show()}),$(".js_scan_rule").on("click",function(){$("#alert_rule").show(),$(".zheceng").show()}),$(".js_content_sub").on("click",function(){$("#alert_message").show(),alert_top("#alert_message"),$(".zheceng").show()}),$(".js_alert_message").on("click",function(){var e=$(".js_hidden_first").val();$(".js_message_name").val(),$(".js_message_tel").val(),$(".js_message_birth").val();"1"==e?birth_test(".js_message_birth",-1,20):(tel_test(".js_message_tel"),china_test(".js_message_name",1,4),birth_test(".js_message_birth",-1,20));var a=$(".border_red").length;if(a>0)return!1});var e={preset:"date",theme:"jqm",display:"modal",mode:"clickpick",dateFormat:"yy-mm-dd",setText:"确定",cancelText:"取消",dateOrder:"yymmdd",dayText:"日",monthText:"月",yearText:"年",yearText:"年",monthText:"月",dayText:"日",endYear:2050,showNow:!0,nowText:"今天",hourText:"小时",minuteText:"分"};$("#f_companydate").mobiscroll(e)}(),$(".js_result_index").get(0)&&~function(){$(document).ready(function(){}),$(".js_result_recharge").on("click",function(){open(location,"_self").close(),WeixinJSBridge.invoke("closeWindow",{},function(e){})})}(),$(".js_alert_con_close").on("click",function(){$(".alert_con").hide(),$(".zheceng").hide(),$(".zheceng1").hide(),$(".zheceng2").hide()}),require.config({baseUrl:"../dest/js",paths:{jquery:["lib/jquery-2.1.4.min","lib/jquery-1.7.2.min","http://libs.baidu.com/jquery/2.0.3/jquery"],mobile:"lib/date/jquery.mobile-1.4.5.min",mobiscroll:"lib/date/mobiscroll",yanzheng:"common/yanzheng",ajaxps:"common/ajaxps",date:"common/date"},shim:{mobiscroll:{deps:["jquery"],exports:"mobiscroll"}}}),require(["jquery","yanzheng","ajaxps","date"],function(e,a,s,t){e(function(){s.get_rule_detail();var r=e("#hidden").val();"1"==r?(e(".js_li_none").show(),e(".js_li_show").hide()):(e(".js_li_none").hide(),e(".js_li_show").show()),e(".js_recharge_index").get(0)&&~function(){e(document).ready(function(){}),t.date(),e(document).on("click",".js_rechage_ul li",function(){e(this).addClass("li_choose").siblings("li").removeClass("li_choose")}),e(".js_content_sub").on("click",function(){e("#alert_message").show(),a.alert_top("#alert_message"),e(".zheceng").show()}),e(".js_alert_message").on("click",function(){var s=e(".js_hidden_first").val();e(".js_message_name").val(),e(".js_message_tel").val(),e(".js_message_birth").val();"1"==s?a.birth_test(".js_message_birth",-1,20):(a.tel_test(".js_message_tel"),a.china_test(".js_message_name",1,4),a.birth_test(".js_message_birth",-1,20));var t=e(".border_red").length;if(t>0)return!1})}(),e(".js_alert_con_close").on("click",function(){e(".alert_con").hide(),e(".zheceng").hide(),e(".zheceng1").hide(),e(".zheceng2").hide()})})});